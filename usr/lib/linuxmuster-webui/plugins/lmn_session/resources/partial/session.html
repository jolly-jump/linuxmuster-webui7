<!-- flow init necessary for filesystem upload-->
<div
    flow-init='{target: "/api/filesystem/upload", chunkSize: 1024 * 1024}'
    flow-files-submitted="onUploadBegin($flow)"
    flow-drop
    >

    <br/>
    <div>
        <div class="input-group">
            <input type="text" style="width:70%" placeholder="Add Student" ng:model="_.addParticipant" typeahead-editable="false" typeahead-min-length="2" uib-typeahead="user as user.sophomorixAdminClass+' '+user.displayName+ ' '+user.sAMAccountName  for user in findUsers($viewValue) | limitTo:10" class="form-control" />
            <input type="text" style="width:30%" placeholder="Add Class" ng:model="_.addSchoolClass" typeahead-editable="false" typeahead-min-length="1" uib-typeahead="schoolClass as schoolClass.sophomorixAdminClass for schoolClass in findSchoolClasses($viewValue) | limitTo:10" class="form-control" />

            <oi-select
                   oi-options="list.id as list.description for list in lists"
                   ng-model="tags"
                   multiple
                   placeholder="Select">
            </oi-select>

    <div uib-dropdown class="input-group-btn">
        <button class="btn btn-default" uib-dropdown-toggle>
            <i class="fa fa-sort-amount-asc"></i> {{sort.name}}
            <span class="caret"></span>
        </button>
        <ul uib-dropdown-menu class="dropdown-menu-right" style="width:150px">
            <li ng:repeat="sort in sorts">
                <a ng:click="$parent.sort = sort">
                    <i class="fa fa-sort-amount-asc"></i> {{sort.name}}
                </a>
            </li>
        </ul>
    </div>
    <div uib-dropdown class="input-group-btn" auto-close="outsideClick">
        <button class="btn btn-default" uib-dropdown-toggle>
            {{'Edit Sessions'|translate}}
            <span class="caret"></span>
        </button>
        <ul uib-dropdown-menu class="dropdown-menu-right" >
            <li>

                <a ng:click="newSession(identity.user)">
                    {{'New Session'|translate}}
                </a>
            </li>
            <li>

                <a ng:click="renameSession(identity.user, currentSession.name, currentSession.comment)" translate>
                    {{'Rename Session'| translate}}
                </a>
            </li>
            <li>
                <a ng:click="killSession(identity.user, currentSession.name, currentSession.comment)" translate>
                    {{'Delete Session'| translate}}
                </a>
        </ul>
    </div>
    <!-- Sessions dropdown -->
    <!-- <div uib-dropdown class="input-group-btn" auto-close="outsideClick" ng:click="getSessions(identity.user)">-->
    <div uib-dropdown class="input-group-btn" auto-close="outsideClick">
        <button class="btn btn-default" uib-dropdown-toggle>
            <i class="fa fa-users"></i> {{'Sessions'|translate}}
            <span class="caret"></span>
        </button>
        <ul uib-dropdown-menu class="dropdown-menu-right" style="width:350px">
            <li ng:repeat="session  in sessions | orderBy: '-COMMENT':true">
                <a ng:click="getParticipants(identity.user,session.ID); currentSession.name=session.ID; currentSession.comment=session.COMMENT"><i class="fa fa-indent"></i> {{session.COMMENT}} {{session.ID}}</a>
            </li>


        </ul>
    </div>
    </div>
    <div id="expand-box-header" class="clearfix">
        <span style="float: left;"> <h4 style="display:{{visible.sessionname}}">{{currentSession.comment}}</h4></span>
        <span style="float: right;"> <h6 style="display:{{visible.sessionname}}">{{currentSession.name}}</h6></span>
    </div>

    <table class="table">
        <tr style="display:{{visible.table}};">
            <th ng:repeat="(id, field) in fields" ng:if="field.visible"><div title="{{field.title}}" class="{{field.icon}}" style="font-size:20px;"></div> <br>{{field.name}}
                <span checkbox style="float:right;" id="{{id}}.all" ng:if="field.examBox" ng-click="selectAll('exammode')" ng:model=field.checkboxStatus>"</span>
                <span checkbox style="float:right;" id="{{id}}.all" ng:if="field.checkboxAll" ng-click="selectAll(id)" ng:model=field.checkboxStatus>"</span></th>
            <th></th>
        </tr>
        <tr style="display:{{visible.table}};"  ng:repeat="(id, participant) in participants">
            <td class="ng-binding"> <a href="#"  ng-click="showDetails = ! showDetails"> <b> {{participant.givenName}}, {{participant.sn}} </b> </a>{{participant.sophomorixAdminClass}}, <br><i> {{id}}</i>
                <div ng-show="showDetails"><img src="https://openclipart.org/image/2400px/svg_to_png/211821/matt-icons_preferences-desktop-personal.png" style="height:75px;"</img></div> </td>
            <td>
                <div class="button-group">
                    <button type="button" class="btn btn-default" ng:click="notImplemented()" translate >Share</button><button type="button" class="btn btn-default" ng:click="notImplemented()" translate>Collect</button>
                </div>
                <div ng-show="showDetails"> <br> <button type="button" class="btn btn-default" ng:click="notImplemented()" translate >Available Files</button> </div> </td>
            </td>
            <td class="ng-binding"><span style="display:inline-block; width:100px; font-size:100%"  class="label label-danger" ng:show="participant.sophomorixRole == 'examuser'"><i class="fa fa-graduation-cap"></i> {{participant.sophomorixExamMode}}</span></td>
            <td width="1" style="text-align:center;"> <span title="Exam by another supervisor" checkbox id="{{id}}.exammode" ng-click="changeClass(id+'.exammode')" ng:model="participant.exammode_boolean" ng:show="participant.sophomorixExamMode == identity.user || participant.sophomorixExamMode == '---'"></span>
                <span uib-dropdown>
                    <button class="btn btn-primary btn-xs" style="color:orange; background:white; font-size:20px" ng:show="participant.sophomorixExamMode != identity.user && participant.sophomorixExamMode != '---'" uib-dropdown-toggle>
                        <i class="fa fa-exclamation-triangle"></i>
                    </button>
                    <ul uib-dropdown-menu class="dropdown-menu-right" >
                        <li>
                            <a ng:click="changeExamSupervisor([id, identity.user])" translate>
                                End running exam and start own exam
                            </a>
                        </li>
                    </ul>
            </td>

            <td width="1" style="text-align:center;"> <span checkbox id="{{id}}.wifiaccess" ng-click="changeClass(id+'.wifiaccess')" ng:model="participant.group_wifiaccess">"</span></td>
            <td width="1" style="text-align:center;"> <span checkbox id="{{id}}.internetaccess" ng-click="changeClass(id+'.internetaccess')" ng:model="participant.group_internetaccess"></span></td>
            <td width="1" style="text-align:center;"> <span checkbox id="{{id}}.intranetaccess" ng-click="changeClass(id+'.intranetaccess')" ng:model="participant.group_intranetaccess"></span></td>
            <td width="1" style="text-align:center;"> <span checkbox id="{{id}}.webfilter" ng-click="changeClass(id+'.webfilter')" ng:model="participant.group_webfilter"></span></td>
            <td width="1" style="text-align:center;"> <span checkbox id="{{id}}.printing" ng-click="changeClass(id+'.printing')" ng:model="participant.group_printing" ></span></td>
            <td width="1">
                <span uib-dropdown>
                    <button class="btn btn-default" uib-dropdown-toggle>
                        <i class="fa fa-cog"></i>
                    </button>
                    <ul uib-dropdown-menu class="dropdown-menu-right" style="width:200px">
                        <li>
                            <a ng:click="showInitialPassword([id])" translate>
                                Show initial password
                            </a>
                        </li>
                        <li>
                            <a ng:click="setInitialPassword([id])" translate>
                                Set Initial password
                            </a>
                        </li>
                        <li>
                            <a ng:click="setRandomPassword([id])" translate>
                                Set Random password
                            </a>
                        </li>
                        <li>
                            <a ng:click="setCustomPassword([id])" translate>
                                Set Custom password
                            </a>
                        </li>
                        <li>
                            <a ng:click="userInfo(id)" translate>
                                User information
                            </a>
                        </li>
                    </ul>
                </span>
            </td>
            <td><button class="btn btn-default" ng:click="removeParticipant(id)"> <i class="fa fa-trash"></i></td>
        </tr>
    </table>

    <div ng:show="info.message != ''" class="alert alert-info">
            <i class="fa fa-info-circle"></i> <span translate>{{info.message}}</span>
        </div>

    <div ng:show="identity.user == 'root'" class="alert alert-info">
            <i class="fa fa-info-circle"></i> <span translate>This module does not work as root. Login as a teacher instead!</span>
        </div>

    <floating-toolbar>
        <div uib-dropdown class="dropup">
            <button class="btn btn-default btn-flat" uib-dropdown-toggle>
                <i class="fa fa-file"></i> Share & Collect <i class="fa fa-caret-up"></i>
            </button>
            <ul uib-dropdown-menu class="scrollable">
                <li><a flow-btn class="btn btn-default btn-flat" test-bind="uploadButton" translate>Upload file to share</a></li>
                <li ng:repeat="example in examples"><a ng:click="createConfig(example)">{{example}}</a></li>
            </ul>
        </div>

        <button ng:click="saveApply(identity.user,participants,currentSession.name)" ng:show="currentSession.name != ''" class="btn btn-default btn-flat pull-right" translate>Save & apply</button>
        <button ng:click="cancel(identity.user,currentSession.name)" ng:show="currentSession.name != ''" class="btn btn-default btn-flat pull-right" translate>Cancel</button>
    </floating-toolbar>



    <div ng:show="identity.user != 'root'">
        <progress-spinner ng:show="sessions == null"></progress-spinner>
        <div ng:show="currentSession.name == ''"  class="list-group">
            <a class="list-group-item" ng:repeat="session in sessions | orderBy: '-COMMENT' :true" ng:click="getParticipants(identity.user,session.ID); currentSession.name=session.ID; currentSession.comment=session.COMMENT">
                <i class="fa fa-users"></i> {{session.COMMENT}}
            </a>
        </div>
    </div>
